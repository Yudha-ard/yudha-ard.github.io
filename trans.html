<!doctypehtml><html lang=id><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>Transtrack Calc</title><link href=https://unpkg.com/leaflet@1.9.4/dist/leaflet.css rel=stylesheet><script src=https://unpkg.com/leaflet@1.9.4/dist/leaflet.js></script><script src=https://unpkg.com/leaflet.animatedmarker@1.0.0/src/AnimatedMarker.js></script><style>@import url(https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap);#location-search:focus,#search-results{background:rgba(255,255,255,.95)}#location-search,#replay-animation-btn{background:rgba(255,255,255,.9);box-shadow:0 4px 15px rgba(0,0,0,.2);transition:.3s}#location-search:focus,#replay-animation-btn:hover{box-shadow:0 6px 20px rgba(0,0,0,.3);transform:translateY(-2px)}.container,.input-group{background:rgba(255,255,255,.1)}.delete-btn,.set-end-btn,.set-start-btn{color:#fff!important}#status-message,.total-item,h1{text-align:center}*{margin:0;padding:0;box-sizing:border-box}body{font-family:Poppins,sans-serif;background:linear-gradient(135deg,#acacac,#000,#000);min-height:100vh;color:#333;padding:20px}.input-group h2,h1,h2{color:rgba(255,255,255,.9)}.container{backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.2);padding:30px;border-radius:20px;box-shadow:0 8px 32px rgba(185,186,198,.37),inset 0 1px 0 rgba(255,255,255,.1);width:100%;max-width:900px;margin:auto;position:relative}#location-search,#replay-animation-btn,#saved-locations-list li,#total-calculation,.input-group{backdrop-filter:blur(10px)}.container::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(255,255,255,.1),rgba(255,255,255,.05));border-radius:20px;pointer-events:none}h1,h2{text-shadow:0 2px 10px rgba(0,0,0,.3)}h1{margin-bottom:20px;font-weight:700;font-size:2.2em}h2{border-bottom:2px solid rgba(255,255,255,.2);padding-bottom:10px;margin-top:30px;font-weight:600}hr{border:none;border-top:1px solid rgba(255,255,255,.2);margin:30px 0}#map,.map-section{border-radius:15px}.map-section{position:relative;overflow:hidden;box-shadow:0 8px 25px rgba(0,0,0,.3)}#replay-animation-btn,.search-container{position:absolute;left:15px;z-index:1000}#map{height:400px;width:100%}.search-container{top:15px;right:15px}#location-search{width:100%;padding:12px 16px;border:none;border-radius:25px;outline:0;font-size:14px}#search-results{backdrop-filter:blur(15px);border-radius:15px;margin-top:8px;max-height:200px;overflow-y:auto;box-shadow:0 4px 20px rgba(0,0,0,.2);border:1px solid rgba(255,255,255,.3)}#search-results div{padding:12px 16px;cursor:pointer;border-bottom:1px solid rgba(0,0,0,.1);transition:.2s}#search-results div:hover{background:rgba(102,126,234,.1);transform:translateX(5px)}#replay-animation-btn{bottom:15px;color:#333;border:none;border-radius:25px;padding:10px 16px;cursor:pointer;font-weight:500}#replay-animation-btn:hover{background:#fff}.input-grid{display:grid;grid-template-columns:1fr 1fr;gap:25px;margin-top:25px}.input-group{border-radius:15px;padding:20px;border:1px solid rgba(255,255,255,.2)}.input-group h2{font-size:1.1em;margin-top:0;border:none;margin-bottom:15px}.coordinate-inputs{display:flex;flex-direction:column;gap:12px}.coordinate-inputs>div{display:flex;flex-direction:column;gap:5px}.coordinate-inputs label{color:rgba(255,255,255,.8);font-size:.9em;font-weight:500}.coordinate-inputs input,.save-form input{color:rgba(255,255,255,.9);outline:0;background:rgba(255,255,255,.1);transition:.3s;backdrop-filter:blur(5px)}.coordinate-inputs input{padding:10px 12px;border:1px solid rgba(255,255,255,.3);border-radius:8px}.coordinate-inputs input:focus,.save-form input:focus{border-color:rgba(255,255,255,.6);background:rgba(255,255,255,.15);box-shadow:0 0 0 3px rgba(102,126,234,.3)}.coordinate-inputs input::placeholder{color:rgba(255,255,255,.5)}#submit-button{width:100%;padding:15px;margin-top:25px;background:linear-gradient(45deg,#686767,#262222e0);color:#fff;border:none;border-radius:25px;font-size:16px;font-weight:600;cursor:pointer;transition:.3s;box-shadow:1px 1px 16px rgba(138,144,172,.4);position:relative;overflow:hidden}#submit-button:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px rgba(52,54,63,.6)}#submit-button:disabled{opacity:.7;cursor:not-allowed;transform:none}.button-loading{display:flex;align-items:center;justify-content:center;gap:10px}.spinner{width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-top:2px solid #fff;border-radius:50%;animation:1s linear infinite spin}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.save-form{display:flex;gap:12px;margin-top:20px;flex-wrap:wrap}.save-form input{flex-grow:1;padding:12px 16px;border:1px solid rgba(255,255,255,.3);border-radius:25px}.save-form input::placeholder{color:rgba(255,255,255,.5)}.save-form button{padding:12px 20px;font-size:.9em;background:rgba(28,28,28,.8);backdrop-filter:blur(3px);border:1px solid rgba(230,230,230,.3);border-radius:25px;color:#fff;cursor:pointer;transition:.3s;font-weight:500}.total-item h3,table{color:rgba(255,255,255,.9)}.save-form button:hover:not(:disabled){background:#2f3b32;transform:translateY(-2px);box-shadow:0 4px 15px rgba(40,65,46,.4)}.save-form button:disabled{opacity:.5;cursor:not-allowed;transform:none}#saved-locations-list{list-style:none;padding:0;margin-top:20px}#saved-locations-list li{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:15px;padding:15px 20px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;transition:.3s}#saved-locations-list li:hover{background:rgba(255,255,255,.15);transform:translateX(5px)}#saved-locations-list .name{font-weight:600;color:rgba(255,255,255,.9)}#saved-locations-list .actions button{padding:6px 12px;font-size:.8em;margin:0 4px;cursor:pointer;border:none;border-radius:15px;transition:.3s;font-weight:500}.set-start-btn{background:rgba(44,61,48,.8)!important}.set-start-btn:hover:not(:disabled){background:#323f35!important;transform:translateY(-2px)}.set-end-btn{background:rgba(44,34,35,.8)!important}.set-end-btn:hover:not(:disabled){background:#2c2223!important;transform:translateY(-2px)}.delete-btn{background:rgba(108,117,125,.8)!important}.table-wrapper,.total-item{background:rgba(255,255,255,.1)}.delete-btn:hover:not(:disabled){background:#6c757d!important;transform:translateY(-2px)}.actions button:disabled{opacity:.5;cursor:not-allowed;transform:none!important}#total-calculation{background:rgba(233,245,255,.2);border:1px solid rgba(184,218,255,.3);border-radius:15px;padding:25px;margin:30px 0}#total-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}.total-item{backdrop-filter:blur(5px);padding:15px;border-radius:10px;border:1px solid rgba(255,255,255,.2)}.total-item h3{margin-bottom:8px;font-size:1em}.total-item .amount{color:#fff;font-size:1.2em;font-weight:600}#status-message{padding:15px;margin-top:20px;border-radius:15px;font-weight:500;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2)}#status-message.error{background:rgba(248,215,218,.9);color:#721c24;border-color:rgba(114,28,36,.3)}#status-message.info{background:rgba(204,229,255,.9);color:#004085;border-color:rgba(0,64,133,.3)}#status-message.success{background:rgba(212,237,218,.9);color:#155724;border-color:rgba(21,87,36,.3)}.table-wrapper{backdrop-filter:blur(10px);border-radius:15px;overflow:hidden;border:1px solid rgba(255,255,255,.2);margin-top:15px}table{width:100%;border-collapse:collapse}table th{background:rgba(102,126,234,.3);padding:12px;text-align:left;font-weight:600;border-bottom:1px solid rgba(255,255,255,.2)}table td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.1)}table tr:hover{background:rgba(255,255,255,.05)}.hidden{display:none!important}.fade-in{animation:.5s ease-in fadeIn}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.pulse{animation:2s infinite pulse}@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(102,126,234,.7)}70%{box-shadow:0 0 0 10px rgba(102,126,234,0)}100%{box-shadow:0 0 0 0 rgba(102,126,234,0)}}@media (max-width:768px){.container{margin:10px;padding:20px}.input-grid{grid-template-columns:1fr;gap:20px}.save-form{flex-direction:column}.save-form button{width:100%}#saved-locations-list li{flex-direction:column;gap:10px;text-align:center}.search-container{left:10px;right:10px}h1{font-size:1.8em}}</style><div class=container><h1>Transtrack Calc</h1><div class=map-section><div class=search-container><input id=location-search placeholder="Cari nama lokasi atau alamat..."><div id=search-results></div></div><div id=map></div><button id=replay-animation-btn class=hidden>‚ñ∂Ô∏è Putar Ulang Animasi</button></div><form id=toll-form><div class=input-grid><div class=input-group><h2>üìç Lokasi Awal (Pin Hijau)</h2><div class=coordinate-inputs><div><label for=start-lat>Latitude</label><input id=start-lat required></div><div><label for=start-lon>Longitude</label><input id=start-lon required></div></div></div><div class=input-group><h2>üèÅ Lokasi Akhir (Pin Merah)</h2><div class=coordinate-inputs><div><label for=end-lat>Latitude</label><input id=end-lat required></div><div><label for=end-lon>Longitude</label><input id=end-lon required></div></div></div></div><button id=submit-button type=submit><span class=button-text>Kalkulasi Rute</span> <span class="hidden spinner"></span></button></form><div id=saved-locations-section><hr><h2>üìç Lokasi Tersimpan</h2><div class=save-form><input id=location-name-input placeholder="Nama Lokasi (e.g., Rumah)"> <button id=save-start-btn>Simpan Lokasi Awal</button> <button id=save-end-btn>Simpan Lokasi Akhir</button></div><ul id=saved-locations-list></ul></div><div class=hidden id=status-message></div><div class=hidden id=results><hr><div id=total-calculation><h2>Ringkasan Total Biaya</h2><div id=total-list></div></div><h2>üõ£ Gerbang Tol</h2><div class=table-wrapper><table id=gates-table><thead><tbody></table></div><h2>üí∞ Harga</h2><div class=table-wrapper><table id=price-table><thead><tbody></table></div></div></div><script>document.addEventListener("DOMContentLoaded",(()=>{const t=L.map("map").setView([-6.2,106.81],10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(t);const e={form:document.getElementById("toll-form"),startLat:document.getElementById("start-lat"),startLon:document.getElementById("start-lon"),endLat:document.getElementById("end-lat"),endLon:document.getElementById("end-lon"),submitBtn:document.getElementById("submit-button"),replayBtn:document.getElementById("replay-animation-btn"),statusMsg:document.getElementById("status-message"),resultsDiv:document.getElementById("results"),totalList:document.getElementById("total-list"),gatesTbody:document.querySelector("#gates-table tbody"),gatesHead:document.querySelector("#gates-table thead"),priceHead:document.querySelector("#price-table thead"),priceBody:document.querySelector("#price-table tbody"),searchInput:document.getElementById("location-search"),searchResults:document.getElementById("search-results"),locationNameInput:document.getElementById("location-name-input"),saveStartBtn:document.getElementById("save-start-btn"),saveEndBtn:document.getElementById("save-end-btn"),savedLocationsList:document.getElementById("saved-locations-list")};let a={routeLine:null,animatedTruck:null,currentRouteLatLngs:[],isLoading:!1,selectedLocation:null,retryCount:0,maxRetries:3};const n={start:L.icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),end:L.icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),truck:L.icon({iconUrl:"https://i.imgur.com/gkqy3I1.png",iconSize:[32,32],iconAnchor:[16,16]})},r=L.marker(t.getCenter(),{draggable:!0,icon:n.start}).addTo(t),o=L.marker(t.getCenter(),{draggable:!0,icon:n.end}).addTo(t);async function s(n,r=!1){r||(a.retryCount=0),p(!0),function(){e.resultsDiv.classList.add("hidden"),a.routeLine&&t.removeLayer(a.routeLine);a.animatedTruck&&t.removeLayer(a.animatedTruck);e.replayBtn.classList.add("hidden"),f()}();try{v("Menghitung rute dan biaya tol...","info");const r=new AbortController,o=setTimeout((()=>r.abort()),3e4),s=await fetch("https://toll-price-playground.transtrack.id/api/v1/calculator",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n),signal:r.signal});if(clearTimeout(o),!s.ok)throw new Error(`Server error: ${s.status} ${s.statusText}`);const i=await s.json();if(!i.success)throw new Error(i.message||"Terjadi kesalahan pada server");if(!i.data||!i.data.locations||i.data.locations.length<2)throw new Error("Data rute tidak valid atau tidak ditemukan");!function({locations:n,touched_gates:r,price:o}){try{e.resultsDiv.classList.remove("hidden"),e.resultsDiv.classList.add("fade-in"),a.currentRouteLatLngs=n.map((t=>[t.lat,t.lon])),function(e){a.routeLine&&t.removeLayer(a.routeLine);a.routeLine=L.polyline(e,{color:"blue",weight:4,opacity:.7}).addTo(t),t.fitBounds(a.routeLine.getBounds(),{padding:[50,50]})}(a.currentRouteLatLngs),d(a.currentRouteLatLngs),r&&r.length>0?e.gatesHead.innerHTML="\n                   <tr>\n                       <th>Nama Gerbang</th>\n                       <th>Latitude</th>\n                       <th>Longitude</th>\n                       <th>Vendor</th>\n                   </tr>\n               ":e.gatesHead.innerHTML="<tr><th>Tidak ada gerbang tol yang dilalui</th></tr>",function(t,e,a){if(t.innerHTML="",!e||0===e.length){return void(t.insertRow().innerHTML='<td colspan="100%" style="text-align: center; font-style: italic;">Tidak ada data</td>')}e.forEach((e=>{const n=t.insertRow();a.forEach((t=>{const a=n.insertCell(),r=(o=e,t.split(".").reduce(((t,e)=>t&&void 0!==t[e]?t[e]:null),o));var o;a.textContent=null!=r?r:"N/A"}))}))}(e.gatesTbody,r,["name","location.lat","location.lon","vendor"]),function(t){if(!t||0===t.length)return e.priceHead.innerHTML="<tr><th>Tidak ada data biaya</th></tr>",void(e.priceBody.innerHTML="");const a=t[0],n=Object.keys(a).filter((t=>"from"!==t&&"to"!==t&&"vendor"!==t));let r="<tr><th>Dari</th><th>Ke</th><th>Vendor</th>";n.forEach((t=>{r+=`<th>${t.toUpperCase().replace("_"," ")}</th>`})),r+="</tr>",e.priceHead.innerHTML=r;const o=e.priceBody;o.innerHTML="",t.forEach((t=>{const e=o.insertRow();e.insertCell().textContent=t.from||"N/A";e.insertCell().textContent=t.to||"N/A";e.insertCell().textContent=t.vendor||"N/A",n.forEach((a=>{const n=e.insertCell(),r=t[a];if(r&&""!==r&&!isNaN(r)){const t=parseInt(r);n.textContent=function(t){const e="number"==typeof t?t:parseInt(t)||0;return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}(t),n.style.fontWeight="600"}else n.textContent="-",n.style.fontWeight="normal",n.style.color="rgba(255,255,255,0.5)"}))}))}(o),function(){e.totalList.innerHTML="";const t=document.getElementById("total-calculation");t&&(t.style.display="none")}()}catch(t){console.error("Display Error:",t),v("Gagal menampilkan hasil. Data mungkin tidak valid.","error")}}(i.data),v("Berhasil menghitung rute dan biaya tol!","success"),a.retryCount=0}catch(t){if(console.error("API Error:",t),"AbortError"===t.name)v("Permintaan timeout. Silakan coba lagi.","error");else if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError")){if(a.retryCount<a.maxRetries)return a.retryCount++,v(`Koneksi bermasalah, mencoba ulang... (${a.retryCount}/${a.maxRetries})`,"info"),void setTimeout((()=>s(n,!0)),2e3);v("Gagal terhubung ke server. Periksa koneksi internet Anda dan coba lagi.","error")}else{const e=t.message||"Terjadi kesalahan tidak dikenal";if(v(`Error: ${e}`,"error"),a.retryCount<a.maxRetries&&!e.includes("Server error: 4"))return a.retryCount++,v(`Mencoba ulang... (${a.retryCount}/${a.maxRetries})`,"info"),void setTimeout((()=>s(n,!0)),2e3)}}finally{p(!1)}}function i(t){const a="start"===t?e.startLat:e.endLat,n="start"===t?e.startLon:e.endLon;return!(!a.value||!n.value||isNaN(parseFloat(a.value))||isNaN(parseFloat(n.value)))||(v(`Koordinat ${"start"===t?"awal":"akhir"} tidak valid`,"error"),!1)}let l;function d(r){if(r&&!(r.length<2)){a.animatedTruck&&t.removeLayer(a.animatedTruck);try{a.animatedTruck=L.animatedMarker(r,{icon:n.truck,distance:1e3,interval:50,autostart:!0,onEnd:()=>{console.log("Animation finished!"),e.replayBtn.classList.add("pulse"),setTimeout((()=>e.replayBtn.classList.remove("pulse")),3e3)}}).addTo(t),e.replayBtn.classList.remove("hidden")}catch(t){console.error("Animation error:",t),v("Gagal memulai animasi","error")}}}function c(){try{return JSON.parse(localStorage.getItem("tollSavedLocations"))||[]}catch{return[]}}function u(t){const a=e.locationNameInput.value.trim();if(!a)return v("Harap masukkan nama lokasi.","error"),void e.locationNameInput.focus();if(a.length>50)v("Nama lokasi terlalu panjang (maksimal 50 karakter).","error");else try{const n=c(),r={id:Date.now(),name:a,timestamp:(new Date).toISOString()};"start"===t?(r.lat=parseFloat(e.startLat.value),r.lon=parseFloat(e.startLon.value)):(r.lat=parseFloat(e.endLat.value),r.lon=parseFloat(e.endLon.value));if(n.some((t=>Math.abs(t.lat-r.lat)<1e-6&&Math.abs(t.lon-r.lon)<1e-6)))return void v("Lokasi dengan koordinat yang sama sudah tersimpan.","error");const o=[r,...n.slice(0,19)];localStorage.setItem("tollSavedLocations",JSON.stringify(o)),e.locationNameInput.value="",m(),v(`Lokasi "${a}" berhasil disimpan!`,"success")}catch(t){console.error("Save location error:",t),v("Gagal menyimpan lokasi.","error")}}function m(){const t=c();if(e.savedLocationsList.innerHTML="",0===t.length){const t=document.createElement("li");return t.innerHTML='<span style="font-style: italic; color: rgba(255,255,255,0.6);">Belum ada lokasi tersimpan</span>',void e.savedLocationsList.appendChild(t)}t.forEach((t=>{const n=document.createElement("li");n.innerHTML=`\n               <div>\n                   <span class="name">${function(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}(t.name)}</span>\n                   <small style="display: block; color: rgba(255,255,255,0.6); font-size: 0.8em;">\n                       ${t.lat.toFixed(6)}, ${t.lon.toFixed(6)}\n                   </small>\n               </div>\n               <div class="actions">\n                   <button class="set-start-btn" data-id="${t.id}" ${a.isLoading?"disabled":""}>Set Awal</button>\n                   <button class="set-end-btn" data-id="${t.id}" ${a.isLoading?"disabled":""}>Set Akhir</button>\n                   <button class="delete-btn" data-id="${t.id}" ${a.isLoading?"disabled":""}>Hapus</button>\n               </div>\n           `,e.savedLocationsList.appendChild(n)}))}function g(){const t=r.getLatLng();e.startLat.value=t.lat.toFixed(7),e.startLon.value=t.lng.toFixed(7);const a=o.getLatLng();e.endLat.value=a.lat.toFixed(7),e.endLon.value=a.lng.toFixed(7)}function h(){try{const a=[parseFloat(e.startLat.value)||-6.2,parseFloat(e.startLon.value)||106.81],n=[parseFloat(e.endLat.value)||-6.25,parseFloat(e.endLon.value)||106.85];r.setLatLng(a),o.setLatLng(n),t.fitBounds([a,n],{padding:[50,50]})}catch(t){console.error("Update markers error:",t)}}function p(t){a.isLoading=t;const n=e.submitBtn.querySelector(".button-text"),r=e.submitBtn.querySelector(".spinner");t?(e.submitBtn.disabled=!0,n.textContent="Memproses...",r.classList.remove("hidden"),e.submitBtn.style.cursor="not-allowed"):(e.submitBtn.disabled=!1,n.textContent="Kalkulasi & Animasikan Rute",r.classList.add("hidden"),e.submitBtn.style.cursor="pointer"),e.saveStartBtn.disabled=t,e.saveEndBtn.disabled=t;e.savedLocationsList.querySelectorAll("button").forEach((e=>e.disabled=t))}function v(t,a="info"){e.statusMsg.textContent=t,e.statusMsg.className=`${a} fade-in`,e.statusMsg.classList.remove("hidden"),"error"!==a&&setTimeout(f,"success"===a?3e3:5e3)}function f(){e.statusMsg.classList.add("hidden")}e.form.addEventListener("submit",(async function(t){if(t.preventDefault(),a.isLoading)return void v("Permintaan sedang diproses, harap tunggu...","info");if(!function(){const t=[{val:e.startLat.value,name:"Latitude Awal"},{val:e.startLon.value,name:"Longitude Awal"},{val:e.endLat.value,name:"Latitude Akhir"},{val:e.endLon.value,name:"Longitude Akhir"}];for(let e of t)if(!e.val||isNaN(parseFloat(e.val)))return v(`${e.name} tidak valid. Masukkan angka yang benar.`,"error"),!1;const a=parseFloat(e.startLat.value),n=parseFloat(e.startLon.value),r=parseFloat(e.endLat.value),o=parseFloat(e.endLon.value);if(Math.abs(a)>90||Math.abs(r)>90)return v("Latitude harus antara -90 hingga 90","error"),!1;if(Math.abs(n)>180||Math.abs(o)>180)return v("Longitude harus antara -180 hingga 180","error"),!1;if(a===r&&n===o)return v("Lokasi awal dan akhir tidak boleh sama","error"),!1;return!0}())return;const n={radius:3,locations:[{lat:parseFloat(e.startLat.value),lon:parseFloat(e.startLon.value)},{lat:parseFloat(e.endLat.value),lon:parseFloat(e.endLon.value)}]};await s(n)})),[r,o].forEach((t=>t.on("dragend",g))),[e.startLat,e.startLon,e.endLat,e.endLon].forEach((t=>t.addEventListener("change",h))),e.searchInput.addEventListener("input",function(t,e){let a;return function(...n){clearTimeout(a),a=setTimeout((()=>{clearTimeout(a),t(...n)}),e)}}((t=>async function(t){if(clearTimeout(l),t.length<3)return void(e.searchResults.innerHTML="");l=setTimeout((async()=>{try{const a=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&countrycodes=id&limit=5`);if(!a.ok)throw new Error("Gagal mencari lokasi");const n=await a.json();if(e.searchResults.innerHTML="",0===n.length){const t=document.createElement("div");return t.textContent="Lokasi tidak ditemukan",t.style.fontStyle="italic",t.style.color="#666",void e.searchResults.appendChild(t)}n.forEach((t=>{const a=document.createElement("div");a.textContent=t.display_name,a.dataset.lat=t.lat,a.dataset.lon=t.lon,e.searchResults.appendChild(a)}))}catch(t){e.searchResults.innerHTML='<div style="color: #d32f2f;">Gagal mencari lokasi</div>'}}),300)}(t.target.value)),300)),e.searchResults.addEventListener("click",(function(a){const n=a.target;if(n.dataset.lat){const a=parseFloat(n.dataset.lat),r=parseFloat(n.dataset.lon);t.setView([a,r],14),e.searchResults.innerHTML="",e.searchInput.value=""}})),e.saveStartBtn.addEventListener("click",(()=>{!a.isLoading&&i("start")&&u("start")})),e.saveEndBtn.addEventListener("click",(()=>{!a.isLoading&&i("end")&&u("end")})),e.savedLocationsList.addEventListener("click",(function(t){if(a.isLoading)return void v("Tunggu hingga proses selesai.","info");const n=t.target.dataset.id;if(!n)return;const s=c(),i=s.find((t=>t.id==n));if(!i)return;try{if(t.target.classList.contains("set-start-btn"))e.startLat.value=i.lat,e.startLon.value=i.lon,r.setLatLng([i.lat,i.lon]),v(`Lokasi awal diset ke "${i.name}"`,"success");else if(t.target.classList.contains("set-end-btn"))e.endLat.value=i.lat,e.endLon.value=i.lon,o.setLatLng([i.lat,i.lon]),v(`Lokasi akhir diset ke "${i.name}"`,"success");else if(t.target.classList.contains("delete-btn")){if(confirm(`Hapus lokasi "${i.name}"?`)){const t=s.filter((t=>t.id!=n));localStorage.setItem("tollSavedLocations",JSON.stringify(t)),m(),v(`Lokasi "${i.name}" dihapus`,"info")}return}h()}catch(t){console.error("Handle saved location error:",t),v("Gagal menggunakan lokasi tersimpan.","error")}})),e.replayBtn.addEventListener("click",(()=>d(a.currentRouteLatLngs))),document.addEventListener("keydown",(t=>{t.ctrlKey&&"Enter"===t.key&&!a.isLoading&&(t.preventDefault(),e.form.dispatchEvent(new Event("submit")))})),g(),m(),window.addEventListener("beforeunload",(()=>{a.animatedTruck&&t.removeLayer(a.animatedTruck),a.routeLine&&t.removeLayer(a.routeLine)}))}));</script>
